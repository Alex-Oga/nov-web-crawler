<h1><%= t ".title" %></h1>

<div style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px;">
  <h3>NovelUpdates Series Finder</h3>
  <%= form_with url: websites_path(@website), method: :get, local: true do |form| %>
    <%= form.label :scrape_url, "NovelUpdates URL:" %>
    <%= form.url_field :scrape_url, placeholder: "https://www.novelupdates.com/series/novel-name/", 
                       style: "width: 400px; margin: 0 10px;", 
                       value: params[:scrape_url] %>
    <%= form.submit "Update Novel Library", style: "padding: 8px 16px;" %>
  <% end %>

  <% if @scrape_error %>
    <div style="margin-top: 10px; padding: 10px; background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 4px;">
      <strong>Error:</strong> <%= @scrape_error %>
    </div>
  <% end %>
</div>

<div style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
  <h3>Refresh Novel Content</h3>
  
  <%= form_with url: scrape_content_websites_path, method: :post, local: true, style: "display: inline;" do |form| %>
    <%= form.submit "Fill All Empty Chapters", 
        style: "padding: 8px 16px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;",
        confirm: "This will scrape content for all empty chapters. This may take a while. Continue?" %>
  <% end %>
  
  <% empty_chapters_count = Chapter.where(content: [nil, '']).count %>
  <small style="color: #666; margin-left: 10px;">
    <%= empty_chapters_count %> Chapters Are Empty
  </small>
</div>

<% if @chapter_data && @chapter_data.any? %>
  <h3>Latest Chapters from NovelUpdates</h3>
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Group</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Chapter</th>
      </tr>
    </thead>
    <tbody>
      <% @chapter_data.each do |data| %>
        <tr>
          <td style="border: 1px solid #ddd; padding: 8px;"><%= data[:group_name] %></td>
          <td style="border: 1px solid #ddd; padding: 8px;">
            <a href="<%= data[:chapter_url] %>" target="_blank"><%= data[:chapter_title] %></a>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
<% end %>

<% if @scrape_results %>
  <div style="margin: 20px 0; padding: 20px; border: 1px solid #28a745; border-radius: 5px; background-color: #d4edda;">
    <h3>Content Scraping Results</h3>
    <p><strong>Scraped:</strong> <%= @scrape_results[:stats][:scraped] %> chapters</p>
    <p><strong>Failed:</strong> <%= @scrape_results[:stats][:failed] %> chapters</p>
  </div>
<% end %>

<div>
<%= link_to "New Website", new_website_path if authenticated? %>
</div>
<br>

<div id="websites">
  <% @websites.each do |website| %>
    <div>
      <%= link_to website.name, website %>
    </div>
  <% end %>
</div>